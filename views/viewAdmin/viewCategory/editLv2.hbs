{{#section 'css'}}
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
{{/section}}

{{#section 'js'}}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('.js-example-basic-single').select2();
    });
    $('#frmUpdate').submit(function (e) {
        e.preventDefault();

        if (validate() == 1) {

            // remove all error before 
            $('#txtValidate').empty();
            // add error text
            let error = $("<p></p>").append("<i class='fa fa-exclamation-triangle' aria-hidden='true'>&nbsp;</i>Vui lòng nhập thông tin !");
            $('#txtValidate').append(error);
            if ($('#txtValidate').hasClass('d-none'))
                $('#txtValidate').removeClass('d-none')
        }
        else {
           validateAvailable();
        //  $('#frmAdd').off('submit').submit();
        }
    });

    function validate() {
        let name = $('#name').val();
        if (!name)
            return 1;
    }
    function validateAvailable() {
        let name = $('#name').val();
        let cat1 = $('#catID1').val();
        $.getJSON(`/admin/categorylv2/add/is-available?category2=${name}?cat1=${cat1}`, function (data) {
            if (data === true) {
                if ($('#txtValidate').hasClass('d-none') == false)
                    $('#txtValidate').addClass('d-none')
                $('#frmUpdate').off('submit').submit();
            }
            else {
                // remove all error before 
                $('#txtValidate').empty();
                // add error text
                let error = $("<p></p>").append("<i class='fa fa-exclamation-triangle' aria-hidden='true'>&nbsp;</i>Tên nhãn đã tồn tại !");
                $('#txtValidate').append(error);
                if ($('#txtValidate').hasClass('d-none'))
                    $('#txtValidate').removeClass('d-none')
            }
        })
    }
</script>
{{/section}}
<!-- main content -->
<div class="wrapper">
    <form id="frmUpdate" class="frm" method="POST" novalidate>
        <h4 class="title">Chỉnh sửa thể loại cấp 2</h4>
        <div class="form-group">
            <label for="id">ID</label>
            <input type="text" id="txtCatID" name="id" readonly value="{{this.category.id}}">
        </div>
        <div class="form-group">
            <label for="name">Tên thể loại</label>
            <input type="text" id="name" name="name" value="{{this.category.name}}" autofocus required>
        </div>
        <div class="form-group">
            <label for="txtHoidap">Chọn thể loại cấp 1</label>
            <select class="js-example-basic-single" name="category_level1">
                {{#each this.catLv1 }}
                <option value="{{id}}" {{#if isActive}} selected {{/if}}>{{name}}</option>
                {{/each}}
            </select>
        </div>
        <hr>
         {{#if error}}
        <h3 class="alert">
            <p>
                <i class='fa fa-exclamation-triangle' aria-hidden='true'>&nbsp;</i>
                {{error.err}}
            <p>
        </h3>
        {{/if}}
        <h4 id="txtValidate" class="alert d-none">
            
        </h4>
        <div class="form-group d-flex">
            <a class="btn btn-primary" href="/admin/category" role="button" title="Back to List">
                <i class="fa fa-backward" aria-hidden="true"></i>
            </a>
            {{#if this.category.delete}}
            <button class="btn btn-success" type="submit" title="Khôi phục" formaction="/admin/categorylv2/restore">
                <i class="fa fa-undo" aria-hidden="true"></i>
            </button>
            {{else}}
            <button class="btn btn-danger" type="submit" title="Xóa thể loại" formaction="/admin/categorylv2/del">
                <i class="fa fa-trash" aria-hidden="true"></i>
            </button>
            {{/if}}
            <button class="btn btn-success" type="submit" formaction="/admin/categorylv2/update">
                <i class="fa fa-check" aria-hidden="true"></i>
                Lưu
            </button>
        </div>
    </form>
</div>
<!-- end main content -->